(()=>{var R={Stringify:1,BeforeStream:2,Stream:3},v=(e,t)=>{let s=new String(e);return s.isEscaped=!0,s.callbacks=t,s},dt=/[&<>'"]/,oe=async e=>{let t="",s=[];for(let r=e.length-1;t+=e[r],r--,!(r<0);r--){let n=await e[r];typeof n=="object"&&s.push(...n.callbacks||[]);let i=n.isEscaped;if(n=await(typeof n=="object"?n.toString():n),typeof n=="object"&&s.push(...n.callbacks||[]),n.isEscaped??i)t+=n;else{let a=[t];M(n,a),t=a[0]}}return v(t,s)},M=(e,t)=>{let s=e.search(dt);if(s===-1){t[0]+=e;return}let r,n,i=0;for(n=s;n<e.length;n++){switch(e.charCodeAt(n)){case 34:r="&quot;";break;case 39:r="&#39;";break;case 38:r="&amp;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}t[0]+=e.substring(i,n)+r,i=n+1}t[0]+=e.substring(i,n)},$=async(e,t,s,r,n)=>{let i=e.callbacks;if(!i?.length)return Promise.resolve(e);n?n[0]+=e:n=[e];let a=Promise.all(i.map(c=>c({phase:t,buffer:n,context:r}))).then(c=>Promise.all(c.filter(Boolean).map(o=>$(o,t,!1,r,n))).then(()=>n[0]));return s?v(await a,i):a};var Ne=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},f=(e,t,s)=>(Ne(e,t,"read from private field"),s?s.call(e):t.get(e)),j=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},x=(e,t,s,r)=>(Ne(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),pt="text/plain; charset=UTF-8",we=(e,t={})=>(Object.entries(t).forEach(([s,r])=>e.set(s,r)),e),W,L,E,m,k,B,V=class{constructor(e,t){this.env={},this._var={},this.finalized=!1,this.error=void 0,j(this,W,200),j(this,L,void 0),j(this,E,void 0),j(this,m,void 0),j(this,k,void 0),j(this,B,!0),this.layout=void 0,this.renderer=s=>this.html(s),this.notFoundHandler=()=>new Response,this.render=(...s)=>this.renderer(...s),this.setLayout=s=>this.layout=s,this.getLayout=()=>this.layout,this.setRenderer=s=>{this.renderer=s},this.header=(s,r,n)=>{if(r===void 0){f(this,E)?f(this,E).delete(s):f(this,m)&&delete f(this,m)[s.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(s);return}n?.append?(f(this,E)||(x(this,B,!1),x(this,E,new Headers(f(this,m))),x(this,m,{})),f(this,E).append(s,r)):f(this,E)?f(this,E).set(s,r):(f(this,m)??x(this,m,{}),f(this,m)[s.toLowerCase()]=r),this.finalized&&(n?.append?this.res.headers.append(s,r):this.res.headers.set(s,r))},this.status=s=>{x(this,B,!1),x(this,W,s)},this.set=(s,r)=>{this._var??(this._var={}),this._var[s]=r},this.get=s=>this._var?this._var[s]:void 0,this.newResponse=(s,r,n)=>{if(f(this,B)&&!n&&!r&&f(this,W)===200)return new Response(s,{headers:f(this,m)});if(r&&typeof r!="number"){let a=we(new Headers(r.headers),f(this,m));return new Response(s,{headers:a,status:r.status??f(this,W)})}let i=typeof r=="number"?r:f(this,W);f(this,m)??x(this,m,{}),f(this,E)??x(this,E,new Headers),we(f(this,E),f(this,m)),f(this,k)&&(f(this,k).headers.forEach((a,c)=>{f(this,E)?.set(c,a)}),we(f(this,E),f(this,m))),n??(n={});for(let[a,c]of Object.entries(n))if(typeof c=="string")f(this,E).set(a,c);else{f(this,E).delete(a);for(let o of c)f(this,E).append(a,o)}return new Response(s,{status:i,headers:f(this,E)})},this.body=(s,r,n)=>typeof r=="number"?this.newResponse(s,r,n):this.newResponse(s,r),this.text=(s,r,n)=>{if(!f(this,m)){if(f(this,B)&&!n&&!r)return new Response(s);x(this,m,{})}return f(this,m)["content-type"]=pt,typeof r=="number"?this.newResponse(s,r,n):this.newResponse(s,r)},this.json=(s,r,n)=>{let i=JSON.stringify(s);return f(this,m)??x(this,m,{}),f(this,m)["content-type"]="application/json; charset=UTF-8",typeof r=="number"?this.newResponse(i,r,n):this.newResponse(i,r)},this.html=(s,r,n)=>(f(this,m)??x(this,m,{}),f(this,m)["content-type"]="text/html; charset=UTF-8",typeof s=="object"&&(s instanceof Promise||(s=s.toString()),s instanceof Promise)?s.then(i=>$(i,R.Stringify,!1,{})).then(i=>typeof r=="number"?this.newResponse(i,r,n):this.newResponse(i,r)):typeof r=="number"?this.newResponse(s,r,n):this.newResponse(s,r)),this.redirect=(s,r=302)=>(f(this,E)??x(this,E,new Headers),f(this,E).set("Location",s),this.newResponse(null,r)),this.notFound=()=>this.notFoundHandler(this),this.req=e,t&&(x(this,L,t.executionCtx),this.env=t.env,t.notFoundHandler&&(this.notFoundHandler=t.notFoundHandler))}get event(){if(f(this,L)&&"respondWith"in f(this,L))return f(this,L);throw Error("This context has no FetchEvent")}get executionCtx(){if(f(this,L))return f(this,L);throw Error("This context has no ExecutionContext")}get res(){return x(this,B,!1),f(this,k)||x(this,k,new Response("404 Not Found",{status:404}))}set res(e){if(x(this,B,!1),f(this,k)&&e){f(this,k).headers.delete("content-type");for(let[t,s]of f(this,k).headers.entries())if(t==="set-cookie"){let r=f(this,k).headers.getSetCookie();e.headers.delete("set-cookie");for(let n of r)e.headers.append("set-cookie",n)}else e.headers.set(t,s)}x(this,k,e),this.finalized=!0}get var(){return{...this._var}}};W=new WeakMap;L=new WeakMap;E=new WeakMap;m=new WeakMap;k=new WeakMap;B=new WeakMap;var Se=(e,t,s)=>(r,n)=>{let i=-1;return a(0);async function a(c){if(c<=i)throw new Error("next() called multiple times");i=c;let o,l=!1,h;if(e[c]?(h=e[c][0][0],r instanceof V&&(r.req.routeIndex=c)):h=c===e.length&&n||void 0,!h)r instanceof V&&r.finalized===!1&&s&&(o=await s(r));else try{o=await h(r,()=>a(c+1))}catch(u){if(u instanceof Error&&r instanceof V&&t)r.error=u,o=await t(u,r),l=!0;else throw u}return o&&(r.finalized===!1||l)&&(r.res=o),r}};var Le=class extends Error{constructor(e=500,t){super(t?.message),this.res=t?.res,this.status=e}getResponse(){return this.res?this.res:new Response(this.message,{status:this.status})}};var Be=async(e,t={all:!1})=>{let r=(e instanceof ae?e.raw.headers:e.headers).get("Content-Type");return mt(r)?vt(e,t):{}};function mt(e){return e===null?!1:e.startsWith("multipart/form-data")||e.startsWith("application/x-www-form-urlencoded")}async function vt(e,t){let s=await e.formData();return s?gt(s,t):{}}function gt(e,t){let s={};return e.forEach((r,n)=>{t.all||n.endsWith("[]")?yt(s,n,r):s[n]=r}),s}var yt=(e,t,s)=>{e[t]&&Et(e[t])?wt(e[t],s):e[t]?St(e,t,s):e[t]=s};function Et(e){return Array.isArray(e)}var wt=(e,t)=>{e.push(t)},St=(e,t,s)=>{e[t]=[e[t],s]};var Re=e=>{let t=e.split("/");return t[0]===""&&t.shift(),t},Ie=e=>{let{groups:t,path:s}=xt(e),r=Re(s);return Rt(r,t)},xt=e=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(s,r)=>{let n=`@${r}`;return t.push([n,s]),n}),{groups:t,path:e}},Rt=(e,t)=>{for(let s=t.length-1;s>=0;s--){let[r]=t[s];for(let n=e.length-1;n>=0;n--)if(e[n].includes(r)){e[n]=e[n].replace(r,t[s][1]);break}}return e},ce={},Ce=e=>{if(e==="*")return"*";let t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);return t?(ce[e]||(t[2]?ce[e]=[e,t[1],new RegExp("^"+t[2]+"$")]:ce[e]=[e,t[1],!0]),ce[e]):null},Te=e=>{let t=e.url.match(/^https?:\/\/[^/]+(\/[^?]*)/);return t?t[1]:""},Fe=e=>{let t=e.indexOf("?",8);return t===-1?"":"?"+e.slice(t+1)},je=e=>{let t=Te(e);return t.length>1&&t[t.length-1]==="/"?t.slice(0,-1):t},q=(...e)=>{let t="",s=!1;for(let r of e)t[t.length-1]==="/"&&(t=t.slice(0,-1),s=!0),r[0]!=="/"&&(r=`/${r}`),r==="/"&&s?t=`${t}/`:r!=="/"&&(t=`${t}${r}`),r==="/"&&t===""&&(t="/");return t},le=e=>{if(!e.match(/\:.+\?$/))return null;let t=e.split("/"),s=[],r="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))r+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){s.length===0&&r===""?s.push("/"):s.push(r);let i=n.replace("?","");r+="/"+i,s.push(r)}else r+="/"+n}),s.filter((n,i,a)=>a.indexOf(n)===i)},xe=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),/%/.test(e)?he(e):e):e,We=(e,t,s)=>{let r;if(!s&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){let c=e.charCodeAt(a+t.length+1);if(c===61){let o=a+t.length+2,l=e.indexOf("&",o);return xe(e.slice(o,l===-1?void 0:l))}else if(c==38||isNaN(c))return"";a=e.indexOf(`&${t}`,a+1)}if(r=/[%+]/.test(e),!r)return}let n={};r??(r=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){let a=e.indexOf("&",i+1),c=e.indexOf("=",i);c>a&&a!==-1&&(c=-1);let o=e.slice(i+1,c===-1?a===-1?void 0:a:c);if(r&&(o=xe(o)),i=a,o==="")continue;let l;c===-1?l="":(l=e.slice(c+1,a===-1?void 0:a),r&&(l=xe(l))),s?(n[o]&&Array.isArray(n[o])||(n[o]=[]),n[o].push(l)):n[o]??(n[o]=l)}return t?n[t]:n},Ve=We,qe=(e,t)=>We(e,t,!0),he=decodeURIComponent;var Ke=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},N=(e,t,s)=>(Ke(e,t,"read from private field"),s?s.call(e):t.get(e)),Ue=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},ze=(e,t,s,r)=>(Ke(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),ee,b,ae=class{constructor(e,t="/",s=[[]]){Ue(this,ee,void 0),Ue(this,b,void 0),this.routeIndex=0,this.bodyCache={},this.cachedBody=r=>{let{bodyCache:n,raw:i}=this,a=n[r];return a||(n.arrayBuffer?(async()=>await new Response(n.arrayBuffer)[r]())():n[r]=i[r]())},this.raw=e,this.path=t,ze(this,b,s),ze(this,ee,{})}param(e){return e?this.getDecodedParam(e):this.getAllDecodedParams()}getDecodedParam(e){let t=N(this,b)[0][this.routeIndex][1][e],s=this.getParamValue(t);return s?/\%/.test(s)?he(s):s:void 0}getAllDecodedParams(){let e={},t=Object.keys(N(this,b)[0][this.routeIndex][1]);for(let s of t){let r=this.getParamValue(N(this,b)[0][this.routeIndex][1][s]);r&&typeof r=="string"&&(e[s]=/\%/.test(r)?he(r):r)}return e}getParamValue(e){return N(this,b)[1]?N(this,b)[1][e]:e}query(e){return Ve(this.url,e)}queries(e){return qe(this.url,e)}header(e){if(e)return this.raw.headers.get(e.toLowerCase())??void 0;let t={};return this.raw.headers.forEach((s,r)=>{t[r]=s}),t}async parseBody(e){if(this.bodyCache.parsedBody)return this.bodyCache.parsedBody;let t=await Be(this,e);return this.bodyCache.parsedBody=t,t}json(){return this.cachedBody("json")}text(){return this.cachedBody("text")}arrayBuffer(){return this.cachedBody("arrayBuffer")}blob(){return this.cachedBody("blob")}formData(){return this.cachedBody("formData")}addValidatedData(e,t){N(this,ee)[e]=t}valid(e){return N(this,ee)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return N(this,b)[0].map(([[,e]])=>e)}get routePath(){return N(this,b)[0].map(([[,e]])=>e)[this.routeIndex].path}};ee=new WeakMap;b=new WeakMap;var g="ALL",Ge="all",Xe=["get","post","put","delete","options","patch"],ue="Can not add a route since the matcher is already built.",fe=class extends Error{};var Je=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},de=(e,t,s)=>(Je(e,t,"read from private field"),s?s.call(e):t.get(e)),Ct=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},pe=(e,t,s,r)=>(Je(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),Tt=Symbol("composedHandler");function _t(){return class{}}var kt=e=>e.text("404 Not Found",404),Qe=(e,t)=>e instanceof Le?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),H,Ye=class extends _t(){constructor(e={}){super(),this._basePath="/",Ct(this,H,"/"),this.routes=[],this.notFoundHandler=kt,this.errorHandler=Qe,this.onError=r=>(this.errorHandler=r,this),this.notFound=r=>(this.notFoundHandler=r,this),this.fetch=(r,n,i)=>this.dispatch(r,i,n,r.method),this.request=(r,n,i,a)=>{if(r instanceof Request)return n!==void 0&&(r=new Request(r,n)),this.fetch(r,i,a);r=r.toString();let c=/^https?:\/\//.test(r)?r:`http://localhost${q("/",r)}`,o=new Request(c,n);return this.fetch(o,i,a)},this.fire=()=>{addEventListener("fetch",r=>{r.respondWith(this.dispatch(r.request,r,void 0,r.request.method))})},[...Xe,Ge].map(r=>{this[r]=(n,...i)=>(typeof n=="string"?pe(this,H,n):this.addRoute(r,de(this,H),n),i.map(a=>{typeof a!="string"&&this.addRoute(r,de(this,H),a)}),this)}),this.on=(r,n,...i)=>{if(!r)return this;for(let a of[n].flat()){pe(this,H,a);for(let c of[r].flat())i.map(o=>{this.addRoute(c.toUpperCase(),de(this,H),o)})}return this},this.use=(r,...n)=>(typeof r=="string"?pe(this,H,r):(pe(this,H,"*"),n.unshift(r)),n.map(i=>{this.addRoute(g,de(this,H),i)}),this);let s=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=s?e.getPath??Te:je}clone(){let e=new Ye({router:this.router,getPath:this.getPath});return e.routes=this.routes,e}route(e,t){let s=this.basePath(e);return t?(t.routes.map(r=>{let n;t.errorHandler===Qe?n=r.handler:(n=async(i,a)=>(await Se([],t.errorHandler)(i,()=>r.handler(i,a))).res,n[Tt]=r.handler),s.addRoute(r.method,r.path,n)}),this):s}basePath(e){let t=this.clone();return t._basePath=q(this._basePath,e),t}mount(e,t,s){let r=q(this._basePath,e),n=r==="/"?0:r.length,i=async(a,c)=>{let o;try{o=a.executionCtx}catch{}let l=s?s(a):[a.env,o],h=Array.isArray(l)?l:[l],u=Fe(a.req.url),d=await t(new Request(new URL((a.req.path.slice(n)||"/")+u,a.req.url),a.req.raw),...h);if(d)return d;await c()};return this.addRoute(g,q(e,"*"),i),this}addRoute(e,t,s){e=e.toUpperCase(),t=q(this._basePath,t);let r={path:t,method:e,handler:s};this.router.add(e,t,[s,r]),this.routes.push(r)}matchRoute(e,t){return this.router.match(e,t)}handleError(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}dispatch(e,t,s,r){if(r==="HEAD")return(async()=>new Response(null,await this.dispatch(e,t,s,"GET")))();let n=this.getPath(e,{env:s}),i=this.matchRoute(r,n),a=new V(new ae(e,n,i),{env:s,executionCtx:t,notFoundHandler:this.notFoundHandler});if(i[0].length===1){let o;try{o=i[0][0][0][0](a,async()=>{a.res=await this.notFoundHandler(a)})}catch(l){return this.handleError(l,a)}return o instanceof Promise?o.then(l=>l||(a.finalized?a.res:this.notFoundHandler(a))).catch(l=>this.handleError(l,a)):o}let c=Se(i[0],this.errorHandler,this.notFoundHandler);return(async()=>{try{let o=await c(a);if(!o.finalized)throw new Error("Context is not finalized. You may forget returning Response object or `await next()`");return o.res}catch(o){return this.handleError(o,a)}})()}},Ze=Ye;H=new WeakMap;var me="[^/]+",te=".*",re="(?:|/.*)",U=Symbol();function Pt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===te||e===re?1:t===te||t===re?-1:e===me?1:t===me?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var ve=class{constructor(){this.children={}}insert(e,t,s,r,n){if(e.length===0){if(this.index!==void 0)throw U;if(n)return;this.index=t;return}let[i,...a]=e,c=i==="*"?a.length===0?["","",te]:["","",me]:i==="/*"?["","",re]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),o;if(c){let l=c[1],h=c[2]||me;if(l&&c[2]&&(h=h.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(h)))throw U;if(o=this.children[h],!o){if(Object.keys(this.children).some(u=>u!==te&&u!==re))throw U;if(n)return;o=this.children[h]=new ve,l!==""&&(o.varIndex=r.varIndex++)}!n&&l!==""&&s.push([l,o.varIndex])}else if(o=this.children[i],!o){if(Object.keys(this.children).some(l=>l.length>1&&l!==te&&l!==re))throw U;if(n)return;o=this.children[i]=new ve}o.insert(a,t,s,r,n)}buildRegExpStr(){let t=Object.keys(this.children).sort(Pt).map(s=>{let r=this.children[s];return(typeof r.varIndex=="number"?`(${s})@${r.varIndex}`:s)+r.buildRegExpStr()});return typeof this.index=="number"&&t.unshift(`#${this.index}`),t.length===0?"":t.length===1?t[0]:"(?:"+t.join("|")+")"}};var et=class{constructor(){this.context={varIndex:0},this.root=new ve}insert(e,t,s){let r=[],n=[];for(let a=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{let l=`@\\${a}`;return n[a]=[l,o],a++,c=!0,l}),!c)break}let i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){let[c]=n[a];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(c)!==-1){i[o]=i[o].replace(c,n[a][1]);break}}return this.root.insert(i,t,r,this.context,s),r}buildRegExp(){let e=this.root.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,s=[],r=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>typeof i<"u"?(s[++t]=Number(i),"$()"):(typeof a<"u"&&(r[Number(a)]=++t),"")),[new RegExp(`^${e}`),s,r]}};var tt=[],At=[/^$/,[],{}],_e={};function rt(e){return _e[e]??(_e[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*/,"(?:|/.*)")}$`))}function bt(){_e={}}function Ht(e){let t=new et,s=[];if(e.length===0)return At;let r=e.map(l=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,h],[u,d])=>l?1:u?-1:h.length-d.length),n={};for(let l=0,h=-1,u=r.length;l<u;l++){let[d,y,p]=r[l];d?n[y]=[p.map(([S])=>[S,{}]),tt]:h++;let w;try{w=t.insert(y,h,d)}catch(S){throw S===U?new fe(y):S}d||(s[h]=p.map(([S,P])=>{let D={};for(P-=1;P>=0;P--){let[A,_]=w[P];D[A]=_}return[S,D]}))}let[i,a,c]=t.buildRegExp();for(let l=0,h=s.length;l<h;l++)for(let u=0,d=s[l].length;u<d;u++){let y=s[l][u]?.[1];if(!y)continue;let p=Object.keys(y);for(let w=0,S=p.length;w<S;w++)y[p[w]]=c[y[p[w]]]}let o=[];for(let l in a)o[l]=s[a[l]];return[i,o,n]}function z(e,t){if(e){for(let s of Object.keys(e).sort((r,n)=>n.length-r.length))if(rt(s).test(t))return[...e[s]]}}var ke=class{constructor(){this.name="RegExpRouter",this.middleware={[g]:{}},this.routes={[g]:{}}}add(e,t,s){var r;let{middleware:n,routes:i}=this;if(!n||!i)throw new Error(ue);n[e]||[n,i].forEach(o=>{o[e]={},Object.keys(o[g]).forEach(l=>{o[e][l]=[...o[g][l]]})}),t==="/*"&&(t="*");let a=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let o=rt(t);e===g?Object.keys(n).forEach(l=>{var h;(h=n[l])[t]||(h[t]=z(n[l],t)||z(n[g],t)||[])}):(r=n[e])[t]||(r[t]=z(n[e],t)||z(n[g],t)||[]),Object.keys(n).forEach(l=>{(e===g||e===l)&&Object.keys(n[l]).forEach(h=>{o.test(h)&&n[l][h].push([s,a])})}),Object.keys(i).forEach(l=>{(e===g||e===l)&&Object.keys(i[l]).forEach(h=>o.test(h)&&i[l][h].push([s,a]))});return}let c=le(t)||[t];for(let o=0,l=c.length;o<l;o++){let h=c[o];Object.keys(i).forEach(u=>{var d;(e===g||e===u)&&((d=i[u])[h]||(d[h]=[...z(n[u],h)||z(n[g],h)||[]]),i[u][h].push([s,a-l+o+1]))})}}match(e,t){bt();let s=this.buildAllMatchers();return this.match=(r,n)=>{let i=s[r]||s[g],a=i[2][n];if(a)return a;let c=n.match(i[0]);if(!c)return[[],tt];let o=c.indexOf("",1);return[i[1][o],c]},this.match(e,t)}buildAllMatchers(){let e={};return[...Object.keys(this.routes),...Object.keys(this.middleware)].forEach(t=>{e[t]||(e[t]=this.buildMatcher(t))}),this.middleware=this.routes=void 0,e}buildMatcher(e){let t=[],s=e===g;return[this.middleware,this.routes].forEach(r=>{let n=r[e]?Object.keys(r[e]).map(i=>[i,r[e][i]]):[];n.length!==0?(s||(s=!0),t.push(...n)):e!==g&&t.push(...Object.keys(r[g]).map(i=>[i,r[g][i]]))}),s?Ht(t):null}};var Pe=class{constructor(e){this.name="SmartRouter",this.routers=[],this.routes=[],Object.assign(this,e)}add(e,t,s){if(!this.routes)throw new Error(ue);this.routes.push([e,t,s])}match(e,t){if(!this.routes)throw new Error("Fatal error");let{routers:s,routes:r}=this,n=s.length,i=0,a;for(;i<n;i++){let c=s[i];try{r.forEach(o=>{c.add(...o)}),a=c.match(e,t)}catch(o){if(o instanceof fe)continue;throw o}this.match=c.match.bind(c),this.routers=[c],this.routes=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}};var Ae=class{constructor(e,t,s){if(this.order=0,this.params={},this.children=s||{},this.methods=[],this.name="",e&&t){let r={};r[e]={handler:t,possibleKeys:[],score:0,name:this.name},this.methods=[r]}this.patterns=[]}insert(e,t,s){this.name=`${e} ${t}`,this.order=++this.order;let r=this,n=Ie(t),i=[],a=[];for(let l=0,h=n.length;l<h;l++){let u=n[l];if(Object.keys(r.children).includes(u)){a.push(...r.patterns),r=r.children[u];let y=Ce(u);y&&i.push(y[1]);continue}r.children[u]=new Ae;let d=Ce(u);d&&(r.patterns.push(d),a.push(...r.patterns),i.push(d[1])),a.push(...r.patterns),r=r.children[u]}r.methods.length||(r.methods=[]);let c={},o={handler:s,possibleKeys:i.filter((l,h,u)=>u.indexOf(l)===h),name:this.name,score:this.order};return c[e]=o,r.methods.push(c),r}gHSets(e,t,s,r){let n=[];for(let i=0,a=e.methods.length;i<a;i++){let c=e.methods[i],o=c[t]||c[g],l={};o!==void 0&&(o.params={},o.possibleKeys.forEach(h=>{let u=l[o.name];o.params[h]=r[h]&&!u?r[h]:s[h]??r[h],l[o.name]=!0}),n.push(o))}return n}search(e,t){let s=[];this.params={};let n=[this],i=Re(t);for(let c=0,o=i.length;c<o;c++){let l=i[c],h=c===o-1,u=[];for(let d=0,y=n.length;d<y;d++){let p=n[d],w=p.children[l];w&&(w.params=p.params,h===!0?(w.children["*"]&&s.push(...this.gHSets(w.children["*"],e,p.params,{})),s.push(...this.gHSets(w,e,p.params,{}))):u.push(w));for(let S=0,P=p.patterns.length;S<P;S++){let D=p.patterns[S],A={...p.params};if(D==="*"){let Z=p.children["*"];Z&&(s.push(...this.gHSets(Z,e,p.params,{})),u.push(Z));continue}if(l==="")continue;let[_,F,C]=D,O=p.children[_],Ee=i.slice(c).join("/");if(C instanceof RegExp&&C.test(Ee)){A[F]=Ee,s.push(...this.gHSets(O,e,p.params,A));continue}(C===!0||C instanceof RegExp&&C.test(l))&&typeof _=="string"&&(A[F]=l,h===!0?(s.push(...this.gHSets(O,e,A,p.params)),O.children["*"]&&s.push(...this.gHSets(O.children["*"],e,A,p.params))):(O.params=A,u.push(O)))}}n=u}return[s.sort((c,o)=>c.score-o.score).map(({handler:c,params:o})=>[c,o])]}};var be=class{constructor(){this.name="TrieRouter",this.node=new Ae}add(e,t,s){let r=le(t);if(r){for(let n of r)this.node.insert(e,n,s);return}this.node.insert(e,t,s)}match(e,t){return this.node.search(e,t)}};var He=class extends Ze{constructor(e={}){super(e),this.router=e.router??new Pe({routers:[new ke,new be]})}};var st=(e,...t)=>{let s=[""];for(let r=0,n=e.length-1;r<n;r++){s[0]+=e[r];let i=t[r]instanceof Array?t[r].flat(1/0):[t[r]];for(let a=0,c=i.length;a<c;a++){let o=i[a];if(typeof o=="string")M(o,s);else if(typeof o=="number")s[0]+=o;else{if(typeof o=="boolean"||o===null||o===void 0)continue;if(typeof o=="object"&&o.isEscaped)if(o.callbacks)s.unshift("",o);else{let l=o.toString();l instanceof Promise?s.unshift("",l):s[0]+=l}else o instanceof Promise?s.unshift("",o):M(o.toString(),s)}}}return s[0]+=e[e.length-1],s.length===1?v(s[0]):oe(s)};var I=Symbol("RENDERER"),K=Symbol("ERROR_HANDLER"),G=Symbol("STASH");var ge=e=>{e&&"className"in e&&(e.class=e.className,delete e.className)};var De=(e,t,s)=>{typeof e=="string"&&ge(t);let r;return t&&"children"in t?(r=t.children,delete t.children):r=[],{tag:e,props:t,key:s,children:Array.isArray(r)?r:[r]}},X=e=>De("",e,void 0);var nt=e=>({value:t,children:s})=>{let r=X({children:[{tag:()=>{e.push(t)}},...s,{tag:()=>{e.pop()}}]});return r[K]=n=>{throw e.pop(),n},r};var Q=[],J=e=>{let t=[e],s={values:t,Provider(r){t.push(r.value);let n;try{n=r.children?(Array.isArray(r.children)?new Oe("",{},r.children):r.children).toString():""}finally{t.pop()}return n instanceof Promise?n.then(i=>v(i,i.callbacks)):v(n)}};return s.Provider[I]=nt(t),Q.push(s),s},se=e=>e.values.at(-1);var Dt=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],Ot=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Me=(e,t)=>{for(let s=0,r=e.length;s<r;s++){let n=e[s];if(typeof n=="string")M(n,t);else{if(typeof n=="boolean"||n===null||n===void 0)continue;n instanceof Y?n.toStringToBuffer(t):typeof n=="number"||n.isEscaped?t[0]+=n:n instanceof Promise?t.unshift("",n):Me(n,t)}}},Y=class{constructor(e,t,s){this.isEscaped=!0,this.tag=e,this.props=t,this.children=s}toString(){let e=[""];this.localContexts?.forEach(([t,s])=>{t.values.push(s)});try{this.toStringToBuffer(e)}finally{this.localContexts?.forEach(([t])=>{t.values.pop()})}return e.length===1?e[0]:oe(e)}toStringToBuffer(e){let t=this.tag,s=this.props,{children:r}=this;e[0]+=`<${t}`;let n=Object.keys(s||{});for(let i=0,a=n.length;i<a;i++){let c=n[i],o=s[c];if(c==="style"&&typeof o=="object"){let l=Object.keys(o).map(h=>`${h.replace(/[A-Z]/g,d=>`-${d.toLowerCase()}`)}:${o[h]}`).join(";");e[0]+=` style="${l}"`}else if(typeof o=="string")e[0]+=` ${c}="`,M(o,e),e[0]+='"';else if(o!=null)if(typeof o=="number"||o.isEscaped)e[0]+=` ${c}="${o}"`;else if(typeof o=="boolean"&&Ot.includes(c))o&&(e[0]+=` ${c}=""`);else if(c==="dangerouslySetInnerHTML"){if(r.length>0)throw"Can only set one of `children` or `props.dangerouslySetInnerHTML`.";r=[v(o.__html)]}else if(o instanceof Promise)e[0]+=` ${c}="`,e.unshift('"',o);else if(typeof o=="function"){if(!c.startsWith("on"))throw`Invalid prop '${c}' of type 'function' supplied to '${t}'.`}else e[0]+=` ${c}="`,M(o.toString(),e),e[0]+='"'}if(Dt.includes(t)){e[0]+="/>";return}e[0]+=">",Me(r,e),e[0]+=`</${t}>`}},Mt=class extends Y{toStringToBuffer(e){let{children:t}=this,s=this.tag.call(null,{...this.props,children:t.length<=1?t[0]:t});if(s instanceof Promise)if(Q.length===0)e.unshift("",s);else{let r=Q.map(n=>[n,n.values.at(-1)]);e.unshift("",s.then(n=>(n instanceof Y&&(n.localContexts=r),n)))}else s instanceof Y?s.toStringToBuffer(e):typeof s=="number"||s.isEscaped?e[0]+=s:M(s,e)}},Oe=class extends Y{toStringToBuffer(e){Me(this.children,e)}},T=(e,t,...s)=>{let r;t&&(r=t?.key,delete t.key);let n=$t(e,t,s);return n.key=r,n},$t=(e,t,s)=>typeof e=="function"?new Mt(e,t,s):(ge(t),new Y(e,t,s));var ne=({children:e})=>new Oe("",{},Array.isArray(e)?e:e?[e]:[]);var it=({children:e,fallback:t,fallbackRender:s,onError:r})=>{let n=X({children:e});return n[K]=i=>{if(i instanceof Promise)throw i;return r?.(i),s?.(i)||t},n},ot=({children:e,fallback:t})=>{let s=X({children:e});return s[K]=(r,n)=>{if(!(r instanceof Promise))throw r;return r.finally(n),t},s};var Nt=0,ye=async e=>{try{return e.map(t=>t.toString())}catch(t){if(t instanceof Promise)return await t,ye(e);throw t}},at=async({children:e,fallback:t,fallbackRender:s,onError:r})=>{if(!e)return v("");Array.isArray(e)||(e=[e]);let n,i=c=>(r?.(c),(n||s?.(c)||"").toString()),a=[];try{a=e.map(c=>c.toString())}catch(c){n=await t?.toString(),c instanceof Promise?a=[c.then(()=>ye(e)).catch(o=>i(o))]:a=[i(c)]}if(a.some(c=>c instanceof Promise)){n||(n=await t?.toString());let c=Nt++,o=RegExp(`(<template id="E:${c}"></template>.*?)(.*?)(<!--E:${c}-->)`),l=!1,h=({error:u,buffer:d})=>{if(l)return"";let y=i(u);return d&&(d[0]=d[0].replace(o,y)),d?"":`<template data-hono-target="E:${c}">${y}</template><script>
((d,c,n) => {
c=d.currentScript.previousSibling
d=d.getElementById('E:${c}')
if(!d)return
do{n=d.nextSibling;n.remove()}while(n.nodeType!=8||n.nodeValue!='E:${c}')
d.replaceWith(c.content)
})(document)
<\/script>`};return v(`<template id="E:${c}"></template><!--E:${c}-->`,[({phase:u,buffer:d,context:y})=>{if(u!==R.BeforeStream)return Promise.all(a).then(async p=>{p=p.flat();let w=p.join(""),S=d?"":`<template data-hono-target="E:${c}">${w}</template><script>
((d,c) => {
c=d.currentScript.previousSibling
d=d.getElementById('E:${c}')
if(!d)return
d.parentElement.insertBefore(c.content,d.nextSibling)
})(document)
<\/script>`;if(p.every(_=>!_.callbacks?.length))return d&&(d[0]=d[0].replace(o,w)),S;d&&(d[0]=d[0].replace(o,(_,F,C,O)=>`${F}${w}${O}`));let P=p.map(_=>_.callbacks||[]).flat();u===R.Stream&&(S=await $(S,R.BeforeStream,!0,y));let D=0,A=P.map(_=>(...F)=>_(...F)?.then(C=>(D++,d?(D===P.length&&(d[0]=d[0].replace(o,(O,Ee,Z)=>Z)),d[0]+=C,v("",C.callbacks)):v(C+(D!==P.length?"":`<script>
((d,c,n) => {
d=d.getElementById('E:${c}')
if(!d)return
n=d.nextSibling
while(n.nodeType!=8||n.nodeValue!='E:${c}'){n=n.nextSibling}
n.remove()
d.remove()
})(document)
<\/script>`),C.callbacks))).catch(C=>h({error:C,buffer:d})));return v(S,A)}).catch(p=>h({error:p,buffer:d}))}])}else return v(a.join(""))};at[I]=it;var ie=[];var Lt=0,lt=async({children:e,fallback:t})=>{if(!e)return t.toString();Array.isArray(e)||(e=[e]);let s=[],r={[G]:[0,[]]},n=i=>(ie.pop(),i);try{r[G][0]=0,ie.push([[],r]),s=e.map(i=>i.toString())}catch(i){if(i instanceof Promise)s=[i.then(()=>(r[G][0]=0,ie.push([[],r]),ye(e).then(n)))];else throw i}finally{n()}if(s.some(i=>i instanceof Promise)){let i=Lt++,a=await t.toString();return v(`<template id="H:${i}"></template>${a}<!--/$-->`,[...a.callbacks||[],({phase:c,buffer:o,context:l})=>{if(c!==R.BeforeStream)return Promise.all(s).then(async h=>{h=h.flat();let u=h.join("");o&&(o[0]=o[0].replace(new RegExp(`<template id="H:${i}"></template>.*?<!--/\\$-->`),u));let d=o?"":`<template data-hono-target="H:${i}">${u}</template><script>
((d,c,n) => {
c=d.currentScript.previousSibling
d=d.getElementById('H:${i}')
if(!d)return
do{n=d.nextSibling;n.remove()}while(n.nodeType!=8||n.nodeValue!='/$')
d.replaceWith(c.content)
})(document)
<\/script>`,y=h.map(p=>p.callbacks||[]).flat();return y.length?(c===R.Stream&&(d=await $(d,R.BeforeStream,!0,l)),v(d,y)):d})}])}else return v(s.join(""))};lt[I]=ot;var ct=new TextEncoder,ht=e=>new ReadableStream({async start(s){let r=e instanceof Promise?await e:await e.toString(),n=typeof r=="object"?r:{},i=await $(r,R.BeforeStream,!0,n);s.enqueue(ct.encode(i));let a=0,c=[],o=l=>{c.push(l.catch(h=>(console.trace(h),"")).then(async h=>{h=await $(h,R.BeforeStream,!0,n),h.callbacks?.map(u=>u({phase:R.Stream,context:n})).filter(Boolean).forEach(o),a++,s.enqueue(ct.encode(h))}))};for(i.callbacks?.map(l=>l({phase:R.Stream,context:n})).filter(Boolean).forEach(o);a!==c.length;)await Promise.all(c);s.close()}});var Bt=J(null),It=(e,t,s,r)=>(n,i)=>{let a=typeof r?.docType=="string"?r.docType:r?.docType===!1?"":"<!DOCTYPE html>",c=s?T(s,{Layout:t,...i},n):n,o=st`${v(a)}${T(Bt.Provider,{value:e},c)}`;return r?.stream?e.body(ht(o),{headers:r.stream===!0?{"Transfer-Encoding":"chunked","Content-Type":"text/html; charset=UTF-8"}:r.stream}):e.html(o)},ut=(e,t)=>function(r,n){let i=r.getLayout()??ne;return e&&r.setLayout(a=>e({...a,Layout:i})),r.setRenderer(It(r,i,e,t)),n()};var ft={light:{color:"#000000",background:"#eeeeee"},dark:{color:"#ffffff",background:"#222222"}},Tn=J(ft.light),Ft=J(ft.dark),$e=new He;$e.use("*",ut(({children:e})=>{let t=se(Ft);return T("html",null,T("head",null,T("title",null,"Test")),T("body",{class:"body",style:t},e))}));$e.get("/",e=>{let t=["one","two","three"];return e.render(T(ne,null,T("h1",null,"tester"),T("ul",null,t.map(s=>T("li",null,s)))))});self.addEventListener("fetch",e=>{new URL(e.request.url).href.includes("petite-vue")||e.respondWith($e.fetch(e.request))});})();
